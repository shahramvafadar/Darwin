@model Darwin.Web.Areas.Admin.ViewModels.Catalog.AddOnGroupAttachToCategoriesVm

@{
    ViewData["Title"] = $"Attach Categories to '{Model.AddOnGroupName}'";
}

<h1 class="mb-2"><i class="fa fa-sitemap"></i> Attach Categories <small class="text-muted">(@Model.AddOnGroupName)</small></h1>

<form method="get" class="row g-2 mb-3" asp-area="Admin" asp-controller="AddOnGroups" asp-action="AttachToCategories">
    <input type="hidden" name="id" value="@Model.AddOnGroupId" />
    <div class="col-auto">
        <input type="text" name="query" value="@Model.Query" class="form-control" placeholder="Search categories." />
    </div>
    <div class="col-auto">
        <button class="btn btn-outline-primary"><i class="fa fa-search"></i> Search</button>
        <a asp-area="Admin" asp-controller="AddOnGroups" asp-action="AttachToCategories" asp-route-id="@Model.AddOnGroupId" class="btn btn-outline-secondary">Reset</a>
    </div>
</form>

<form asp-area="Admin" asp-controller="AddOnGroups" asp-action="AttachToCategories" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="AddOnGroupId" value="@Model.AddOnGroupId" />
    <input type="hidden" name="RowVersion" value="@(Model.RowVersion is null ? "" : Convert.ToBase64String(Model.RowVersion))" />

    <div class="table-responsive">
        <table class="table table-sm table-striped align-middle">
            <thead>
                <tr>
                    <th style="width:40px" class="text-center"><input type="checkbox" id="toggleAll" /></th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Items is null || Model.Items.Count == 0)
                {
                    <tr><td colspan="2" class="text-center text-muted">No categories.</td></tr>
                }
                else
                {
                    foreach (var c in Model.Items)
                    {
                        <tr>
                            <td class="text-center">
                                <input type="checkbox" class="row-check" name="SelectedCategoryIds" value="@c.Id" @(c.Selected ? "checked" : "") />
                            </td>
                            <td>@c.Display</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <pager page="Model.Page"
           page-size="Model.PageSize"
           total="Model.Total"
           asp-area="Admin"
           asp-controller="AddOnGroups"
           asp-action="AttachToCategories"
           asp-route-id="@Model.AddOnGroupId"
           asp-route-query="@Model.Query">
    </pager>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Save Attachments</button>
        <a asp-area="Admin" asp-controller="AddOnGroups" asp-action="Index" class="btn btn-outline-secondary">Back</a>
    </div>
</form>

@section Scripts {
    <script>
        const toggle = document.getElementById('toggleAll');
        if (toggle) toggle.addEventListener('change', function () {
            document.querySelectorAll('.row-check').forEach(cb => cb.checked = toggle.checked);
        });
    </script>
}
