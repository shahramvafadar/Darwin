@model Darwin.Web.Areas.Admin.ViewModels.Catalog.AddOnGroupAttachToVariantsVm

@{
    ViewData["Title"] = $"Attach Variants to '{Model.AddOnGroupName}'";
}

<h1 class="mb-2"><i class="fa fa-list"></i> Attach Variants <small class="text-muted">(@Model.AddOnGroupName)</small></h1>

<div class="alert alert-info">
    This screen is minimal: paste one or more Variant IDs (GUIDs), separated by commas or new lines.
    In product/variant pages you can provide richer pickers later.
</div>

<form asp-area="Admin" asp-controller="AddOnGroups" asp-action="AttachToVariants" method="post" id="variantsForm">
    @Html.AntiForgeryToken()
    <input type="hidden" name="AddOnGroupId" value="@Model.AddOnGroupId" />
    <input type="hidden" name="RowVersion" value="@(Model.RowVersion is null ? "" : Convert.ToBase64String(Model.RowVersion))" />

    <div class="mb-3">
        <label for="variantIds" class="form-label">Variant IDs</label>
        <textarea id="variantIds" class="form-control" rows="6" placeholder="11111111-1111-1111-1111-111111111111"></textarea>
        <small class="text-muted">Comma- or newline-separated GUIDs. Invalid tokens will be ignored.</small>
    </div>

    <div class="mt-2">
        <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Save Attachments</button>
        <a asp-area="Admin" asp-controller="AddOnGroups" asp-action="Index" class="btn btn-outline-secondary">Back</a>
    </div>
</form>

@section Scripts {
    <script>
        document.getElementById('variantsForm').addEventListener('submit', function (e) {
            const txt = document.getElementById('variantIds').value || '';
            const tokens = txt.split(/[\s,;]+/).map(t => t.trim()).filter(t => t.length > 0);
            const form = e.currentTarget;

            // remove old
            form.querySelectorAll('input[name="SelectedVariantIds"]').forEach(el => el.remove());

            // add hidden inputs for model binding
            tokens.forEach(g => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'SelectedVariantIds';
                input.value = g;
                form.appendChild(input);
            });
        });
    </script>
}
