@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@* 
    Generic confirmation modal for destructive actions (delete).
    - Accessible: role=dialog, aria-* set.
    - Mobile-friendly: Bootstrap modal, large touch targets.
    - Posts to a dynamic form action with Anti-Forgery token.
*@
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteTitle">Confirm deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" />
            </div>
            <div class="modal-body">
                <p class="mb-2">This action cannot be undone.</p>
                <p class="fw-semibold mb-0">
                    Item:
                    <span id="confirmDeleteName" class="text-danger"></span>
                </p>
            </div>
            <div class="modal-footer">
                <form id="confirmDeleteForm" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" id="confirmDeleteId" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
          const modalEl = document.getElementById('confirmDeleteModal');
          const nameSpan = document.getElementById('confirmDeleteName');
          const idInput = document.getElementById('confirmDeleteId');
          const form = document.getElementById('confirmDeleteForm');
          let bsModal;

          function ensureModal() {
            if (!bsModal) { bsModal = new bootstrap.Modal(modalEl); }
            return bsModal;
          }

          // Wire global handler for any "data-confirm-delete" button/link
          document.addEventListener('click', function (e) {
            const btn = e.target.closest('[data-confirm-delete]');
            if (!btn) return;

            e.preventDefault();

            const action = btn.getAttribute('data-action');    // form action url (POST)
            const id = btn.getAttribute('data-id');            // entity id (Guid)
            const name = btn.getAttribute('data-name') || '';  // user-friendly name

            if (!action || !id) return;

            nameSpan.textContent = name;
            idInput.value = id;
            form.setAttribute('action', action);

            ensureModal().show();
          });
        })();
    </script>
}
