@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Anmelden";
    var returnUrl = (string?)ViewData["ReturnUrl"] ?? "";
}

<h1 class="mb-3">Anmelden</h1>

<form asp-action="LoginPost" asp-controller="Account" method="post" class="mb-3">
    @Html.AntiForgeryToken()
    <input type="hidden" name="returnUrl" value="@returnUrl" />
    <div class="mb-3">
        <label for="email" class="form-label">E-Mail</label>
        <input id="email" name="email" type="email" class="form-control" required />
        <span class="text-danger field-validation-valid" data-valmsg-for="email" data-valmsg-replace="true"></span>
    </div>
    <div class="mb-3">
        <label for="password" class="form-label">Passwort</label>
        <input id="password" name="password" type="password" class="form-control" required />
        <span class="text-danger field-validation-valid" data-valmsg-for="password" data-valmsg-replace="true"></span>
    </div>
    <div class="form-check mb-3">
        <input id="rememberMe" name="rememberMe" type="checkbox" class="form-check-input" />
        <label for="rememberMe" class="form-check-label">Angemeldet bleiben</label>
    </div>
    <div class="text-end">
        <button class="btn btn-primary" type="submit">Anmelden</button>
    </div>
</form>

<!-- Passkey UI kept hidden until user resolution flow is wired (server expects userId). -->
<fieldset class="d-none">
    <form id="passkey-form" method="post" action="/account/webauthn/finish-login">
        @Html.AntiForgeryToken()
        <input type="hidden" name="challengeTokenId" id="challengeTokenId" />
        <input type="hidden" name="clientResponseJson" id="clientResponseJson" />
        <input type="hidden" name="userId" id="userId" />
        <input type="hidden" name="rememberMe" value="true" />
        <input type="hidden" name="returnUrl" value="@returnUrl" />
    </form>
    <button id="passkey-btn" class="btn btn-secondary mt-2" type="button">Mit Passkey anmelden</button>
</fieldset>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // TODO: Resolve userId by email before begin-login and unhide this block when available.
        document.getElementById('passkey-btn')?.addEventListener('click', () => {
            alert('Passkey-Anmeldung wird vorbereitet.');
        });
    </script>
}
